{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 49, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/MuhammadNabilBinMaha/Videos/PREFECT-10/config/db.js"],"sourcesContent":["import mongoose from 'mongoose';\r\n\r\nconst { MONGODB_URI } = process.env;\r\nif (!MONGODB_URI) throw new Error('MONGODB_URI missing');\r\n\r\nlet cached = global.mongoose || (global.mongoose = { conn: null, promise: null });\r\n\r\nexport default async function dbConnect() {\r\n  if (cached.conn) return cached.conn;\r\n  if (!cached.promise) {\r\n    cached.promise = mongoose.connect(MONGODB_URI, {\r\n      bufferCommands: false,\r\n      dbName: 'Prefect-10', \r\n    }).then(m => m);\r\n  }\r\n  cached.conn = await cached.promise;\r\n  return cached.conn;\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,EAAE,WAAW,EAAE,GAAG,QAAQ,GAAG;AACnC,IAAI,CAAC,aAAa,MAAM,IAAI,MAAM;AAElC,IAAI,SAAS,yDAAO,QAAQ,IAAI,CAAC,yDAAO,QAAQ,GAAG;IAAE,MAAM;IAAM,SAAS;AAAK,CAAC;AAEjE,eAAe;IAC5B,IAAI,OAAO,IAAI,EAAE,OAAO,OAAO,IAAI;IACnC,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,aAAa;YAC7C,gBAAgB;YAChB,QAAQ;QACV,GAAG,IAAI,CAAC,CAAA,IAAK;IACf;IACA,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IAClC,OAAO,OAAO,IAAI;AACpB","debugId":null}},
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/MuhammadNabilBinMaha/Videos/PREFECT-10/models/Chat.js"],"sourcesContent":["import mongoose from \"mongoose\";\r\n\r\nconst ChatSchema = new mongoose.Schema(\r\n    {\r\n        name: {type: String, required: true},\r\n        messages: [\r\n            {\r\n                role: {type: String, required: true},\r\n                content: {type: String, required: true},\r\n                timestamp: {type: Number, required: true},\r\n            },\r\n        ],\r\n        userId: {type: String, required: true},\r\n    },\r\n    {timestamps: true}\r\n);\r\n\r\nconst Chat = mongoose.models.Chat || mongoose.model(\"Chat\", ChatSchema)\r\n\r\nexport default Chat;"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,aAAa,IAAI,oHAAQ,CAAC,MAAM,CAClC;IACI,MAAM;QAAC,MAAM;QAAQ,UAAU;IAAI;IACnC,UAAU;QACN;YACI,MAAM;gBAAC,MAAM;gBAAQ,UAAU;YAAI;YACnC,SAAS;gBAAC,MAAM;gBAAQ,UAAU;YAAI;YACtC,WAAW;gBAAC,MAAM;gBAAQ,UAAU;YAAI;QAC5C;KACH;IACD,QAAQ;QAAC,MAAM;QAAQ,UAAU;IAAI;AACzC,GACA;IAAC,YAAY;AAAI;AAGrB,MAAM,OAAO,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAC,QAAQ;uCAE7C","debugId":null}},
    {"offset": {"line": 194, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/MuhammadNabilBinMaha/Videos/PREFECT-10/app/api/chat/ai/route.js"],"sourcesContent":["export const maxDuration = 60;\r\nimport connectDB from \"@/config/db\";\r\nimport Chat from \"@/models/Chat\";\r\nimport { getAuth } from \"@clerk/nextjs/server\";\r\nimport { NextResponse } from \"next/server\";\r\nimport OpenAI from \"openai\";\r\n\r\n\r\n// Initialize OpenAI client with DeepSeek API key and base URL\r\nconst openai = new OpenAI({\r\n    baseURL: 'https://api.deepseek.com',\r\n    apiKey: process.env.DEEPSEEK_API_KEY\r\n});\r\n\r\nexport async function POST(req){\r\n    try {\r\n        const {userId} = getAuth(req)\r\n\r\n        // Extract chatId and prompt from the request body\r\n        const { chatId, prompt } = await req.json();\r\n\r\n        if(!userId){\r\n            return NextResponse.json({\r\n                success: false,\r\n                message: \"User not authenticated\",\r\n              });\r\n        }\r\n\r\n        // Find the chat document in the database based on userId and chatId\r\n        await connectDB()\r\n        const data = await Chat.findOne({userId, _id: chatId})\r\n\r\n        // Create a user message object\r\n        const userPrompt = {\r\n            role: \"user\",\r\n            content: prompt,\r\n            timestamp: Date.now()\r\n        };\r\n\r\n        data.messages.push(userPrompt);\r\n\r\n        // Call the DeepSeek API to get a chat completion\r\n\r\n        const completion = await openai.chat.completions.create({\r\n            messages: [{ role: \"user\", content: prompt }],\r\n            model: \"deepseek-chat\",\r\n            store: true,\r\n        });\r\n\r\n        const message = completion.choices[0].message;\r\n        message.timestamp = Date.now()\r\n        data.messages.push(message);\r\n        data.save();\r\n\r\n        return NextResponse.json({success: true, data: message})\r\n    } catch (error) {\r\n        return NextResponse.json({ success: false, error: error.message });\r\n    }\r\n}"],"names":[],"mappings":";;;;;;AACA;AACA;AACA;AACA;AACA;AALO,MAAM,cAAc;;;;;;AAQ3B,8DAA8D;AAC9D,MAAM,SAAS,IAAI,8KAAM,CAAC;IACtB,SAAS;IACT,QAAQ,QAAQ,GAAG,CAAC,gBAAgB;AACxC;AAEO,eAAe,KAAK,GAAG;IAC1B,IAAI;QACA,MAAM,EAAC,MAAM,EAAC,GAAG,IAAA,yMAAO,EAAC;QAEzB,kDAAkD;QAClD,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,IAAI,IAAI;QAEzC,IAAG,CAAC,QAAO;YACP,OAAO,iKAAY,CAAC,IAAI,CAAC;gBACrB,SAAS;gBACT,SAAS;YACX;QACN;QAEA,oEAAoE;QACpE,MAAM,IAAA,0IAAS;QACf,MAAM,OAAO,MAAM,4IAAI,CAAC,OAAO,CAAC;YAAC;YAAQ,KAAK;QAAM;QAEpD,+BAA+B;QAC/B,MAAM,aAAa;YACf,MAAM;YACN,SAAS;YACT,WAAW,KAAK,GAAG;QACvB;QAEA,KAAK,QAAQ,CAAC,IAAI,CAAC;QAEnB,iDAAiD;QAEjD,MAAM,aAAa,MAAM,OAAO,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;YACpD,UAAU;gBAAC;oBAAE,MAAM;oBAAQ,SAAS;gBAAO;aAAE;YAC7C,OAAO;YACP,OAAO;QACX;QAEA,MAAM,UAAU,WAAW,OAAO,CAAC,EAAE,CAAC,OAAO;QAC7C,QAAQ,SAAS,GAAG,KAAK,GAAG;QAC5B,KAAK,QAAQ,CAAC,IAAI,CAAC;QACnB,KAAK,IAAI;QAET,OAAO,iKAAY,CAAC,IAAI,CAAC;YAAC,SAAS;YAAM,MAAM;QAAO;IAC1D,EAAE,OAAO,OAAO;QACZ,OAAO,iKAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC;IACpE;AACJ","debugId":null}}]
}